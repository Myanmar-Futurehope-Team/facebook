{% import "_includes/forms" as forms %}
{% extends "_layouts/cp" %}

{% set title = "Facebook"|t %}

{% set content %}

    {% set response = craft.facebook.api.get('/me/accounts') %}

    {% set accounts = response.data.data %}

    {% for account in accounts %}
        <h2>{{ account.name }}</h2>

        {% set conversationsResponse = craft.facebook.api.get('/'~account.id~'/conversations', null, {
            'Authorization' : 'Bearer '~account.access_token
        }) %}

        {% set conversations = conversationsResponse.data.data %}

        <table class="data fullwidth">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Message</th>
                </tr>
            </thead>
            <tbody>
                {% for conversation in conversations %}
                    <tr>
                        <td>{{ conversation.updated_time }}</td>
                        <td>
                            {% if conversation.snippet is defined %}
                                {{ conversation.snippet }}
                            {% else %}
                                No snippet
                            {% endif %}

                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        <hr>

    {% endfor %}


{% endset %}
