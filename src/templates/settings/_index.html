{% extends "facebook/_layouts/settings" %}

{% import "_includes/forms" as forms %}

{% set docsUrl = 'https://dukt.net/craft/facebook/docs' %}

{% macro configWarning(setting, file) -%}
    {{ "This is being overridden by the {setting} config setting."|t({
        setting: '<strong>'~setting~'</strong>'
    })|raw }}
{%- endmacro %}

{% from _self import configWarning %}


{% set content %}

    {% if not error %}
        {% if account %}

            <form method="post" accept-charset="UTF-8" data-saveshortcut>
                {{ csrfInput() }}

                <input type="hidden" name="action" value="plugins/save-plugin-settings">
                <input type="hidden" name="pluginHandle" value="facebook">
                <input type="hidden" name="redirect" value="{{ 'facebook/settings'|hash }}">

                <h2 class="first">{{'Facebook Account'|t}}</h2>
                <p>{{'You are authenticated to Facebook with the following account'|t}} :</p>

                <ul>
                    <li><strong>{{ 'UID'|t }} : </strong> {{ account.id }}</li>
                    <li><strong>{{ 'Name'|t }} : </strong> {{ account.name }}</li>
                </ul>

                <p><a class="btn small" href="{{ actionUrl('facebook/oauth/disconnect') }}">{{'Disconnect'|t}}</a></p>

                <hr>

                <h2 class="first">{{'Insights Settings'|t}}</h2>

                {{ forms.textField({
                    label: "Facebook Page ID"|t,
                    placeholder: "123456789012345",
                    name: 'settings[facebookInsightsObjectId]',
                    value: settings.facebookInsightsObjectId,
                    size: 20,
                }) }}

                <div class="buttons">
                    <input type="submit" class="btn submit force" value="{{'Save'|t}}">
                </div>
            </form>

        {% else %}
            <h2>{{ 'Create the OAuth application'|t('facebook') }}</h2>

			<p>{{ 'Go to the {link} and click the “Add a new app” button.'|t('facebook', {link: '<a href="https://developers.facebook.com/apps">'~'Facebook API Console'|t('facebook')~'</a>'})|raw }}</p>
			<p>{{ 'Fill the display name, contact email and category fields and click “Create App ID”.'|t('facebook') }}</p>
			<p>{{ 'Go to the app that you have just created and click “Add product”.'|t('facebook') }}</p>
			<p>{{ 'Find the “Facebook Login” section, click “Get Started” and configure your app with the informations below.'|t('facebook') }}</p>


			{{ forms.textField({
				readonly: true,
				label: "Redirect URI",
				value: redirectUri
			}) }}

			<h2>{{ 'Configure the OAuth client'|t('facebook') }}</h2>

			<p>{{ 'Once the OAuth client is created, Facebook will provide you with a client ID and secret.'|t('facebook') }}</p>
			<p>{{ ("Copy the Client ID (App ID) & secret (App Secret) from the <a href=\"https://developers.facebook.com/apps\">"~'Facebook API Console'|t('facebook')~"</a> under the Settings → Basic tab, and paste them in the <code>craft/config/facebook.php</code> config file.")|raw }}</p>

			{{ forms.textField({
				readonly: true,
				label: "Client ID",
				value: oauthProviderOptions.clientId
			}) }}

			{{ forms.textField({
				readonly: true,
				label: "Client Secret",
				value: oauthProviderOptions.clientSecret
			}) }}

            <p><a class="btn submit" href="{{ actionUrl('facebook/oauth/connect') }}">{{"Connect to Facebook"|t}}</a></p>

        {% endif %}
    {% else %}

        <h2 class="first">{{'Facebook Account'|t}}</h2>
        <p class="error">{{ error }}</p>

        {% if token %}
            <p><a class="btn small" href="{{ actionUrl('facebook/oauth/disconnect') }}">{{'Disconnect'|t}}</a></p>
        {% endif %}

    {% endif %}

{% endset %}

